### 06 工程部署与推理优化

#### 推理框架
- vLLM（支持Qwen-VL等视觉-语言模型）、TensorRT-LLM（需要图像分支支持）、OpenVINO（CPU端可选）。

#### 性能要点
- 图像前处理并行化（解码/缩放/归一化多线程）；
- 批处理：按图像分辨率与token占用分桶；
- KV缓存/分页注意力：长图文/长视频对话；
- 显存管理：高分辨率图像/视频帧需监控水位，必要时走CPU/NVMe交换。

#### 简单Python示例（本地推理伪代码）
```python
from PIL import Image
import requests

img = Image.open("invoice.jpg")
payload = {
  "model": "qwen2-vl",
  "messages": [
    {"role": "user", "content": "请读取发票金额"},
    {"role": "user", "image": "<base64_of_img>"}
  ]
}
r = requests.post("http://localhost:8000/v1/chat/completions", json=payload)
print(r.json())
```


