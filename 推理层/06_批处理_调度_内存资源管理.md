### 06 批处理、调度与内存资源管理

本篇讨论服务端吞吐的核心工程策略。

#### 批处理（Batching）
- 静态批与动态批：动态批根据队列等待时间和最大批大小动态合并请求。
- 持续批（Continuous Batching）：在解码阶段持续加入新请求，提升设备利用率。
- 小结：提升吞吐但可能增加P99延迟，需与SLA权衡。

#### 调度器
- 目标：在高并发下保持公平与优先级，降低饥饿与抖动。
- 策略：优先级队列、最短剩余时间优先（SRPT）、Deadline-aware、租户隔离。

#### 内存与显存管理
- 权重只读共享与内存映射；页式KV缓存减少碎片；Pinned Memory与零拷贝路径。
- 显存水位与回收：水位阈值、分段回收；冷数据转CPU或NVMe。

#### 资源感知与拓扑优化
- NVLink链路、PCIe层级、NUMA亲和；绑定策略减少跨NUMA访问。

#### 租户与隔离
- 不同业务/租户QPS与令牌配额、速率限制；软硬隔离结合（命名空间/节点池）。


